(function(){var EventProxy=function(){this._callbacks={};this._fired={}};EventProxy.prototype.bind=EventProxy.prototype.on=EventProxy.prototype.addListener=function(ev,callback){this._callbacks=this._callbacks||{};var list=this._callbacks[ev]||(this._callbacks[ev]=[]);list.push(callback);return this};EventProxy.prototype.unbind=EventProxy.prototype.removeListener=function(ev,callback){var calls;if(!ev){this._callbacks={}}else if(calls=this._callbacks){if(!callback){calls[ev]=[]}else{var list=calls[ev];if(!list)return this;for(var i=0,l=list.length;i<l;i++){if(callback===list[i]){list[i]=null;break}}}}return this};EventProxy.prototype.removeAllListeners=function(event){return this.unbind(event)};EventProxy.prototype.emit=EventProxy.prototype.fire=EventProxy.prototype.trigger=function(eventName,data,data2){var list,calls,ev,callback,args,i,l;var both=2;if(!(calls=this._callbacks))return this;while(both--){ev=both?eventName:'all';if(list=calls[ev]){for(i=0,l=list.length;i<l;i++){if(!(callback=list[i])){list.splice(i,1);i--;l--}else{args=both?Array.prototype.slice.call(arguments,1):arguments;callback.apply(this,args)}}}}return this};EventProxy.prototype.once=function(ev,callback){var self=this;this.bind(ev,function(){callback.apply(self,arguments);self.unbind(ev,arguments.callee)});return this};var _assign=function(eventname1,eventname2,cb,once){var proxy=this,length,index=0,argsLength=arguments.length,callback,events,isOnce,times=0,flag={};if(argsLength<3){return this}events=[].slice.apply(arguments,[0,argsLength-2]);callback=arguments[argsLength-2];isOnce=arguments[argsLength-1];if(typeof callback!=="function"){return this}length=events.length;var bind=function(key){var method=isOnce?"once":"bind";proxy[method](key,function(data){proxy._fired[key]=proxy._fired[key]||{};proxy._fired[key].data=data;if(!flag[key]){flag[key]=true;times++}})};for(index=0;index<length;index++){bind(events[index])}var all=function(){if(times<length){return}var data=[];for(index=0;index<length;index++){data.push(proxy._fired[events[index]].data)}if(isOnce){proxy.unbind("all",all)}callback.apply(null,data)};proxy.bind("all",all)};EventProxy.prototype.assign=function(eventname1,eventname2,cb){var args=[].slice.call(arguments);args.push(true);_assign.apply(this,args);return this};EventProxy.prototype.assignAll=EventProxy.prototype.assignAlways=function(){var args=[].slice.call(arguments);args.push(false);_assign.apply(this,args);return this};EventProxy.prototype.after=function(eventName,times,callback){var proxy=this,firedData=[],all=function(name,fired){if(name===eventName){times--;firedData.push(data);if(times<1){proxy.unbind("all",all);callback.apply(null,[firedData])}}};proxy.bind("all",all);return this};if(typeof exports!=="undefined"){exports.EventProxy=EventProxy}else{window.EventProxy=EventProxy}}());